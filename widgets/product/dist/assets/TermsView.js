import{c as De,d as Ge,v as Ue,u as je,a as qe,t as ze,b as Ke,V as Z,_ as Qe,P as Xe,e as Ze,g as We}from"./navigation.js";import{_ as ae,c as Je,d as Ye,b as Ie,L as G,a as ea,u as be,s as W,f as aa,C as ye,e as xe}from"./index.js";import{e as n,f as r,L as te,d as se,r as c,z as o,H as ee,D as B,G as k,K as ta,b as Te,F as b,V as S,W as U,y as J,u as l,N as Y,I as ke,U as sa}from"./embedder.js";const na={},la={class:"consent-box"};function oa(C,v){return n(),r("div",la,[te(C.$slots,"default",{},void 0,!0)])}const ra=ae(na,[["render",oa],["__scopeId","data-v-640f049a"]]),ia=["id","value","checked","disabled"],ua=["for","innerHTML"],da={key:0,class:"md:ml-1"},ca={class:"pl-[30px] mt-1"},va=se({__name:"ConsentItem",props:{id:{},label:{},value:{type:Boolean},disabled:{type:Boolean,default:!1},showFull:{type:Boolean,default:!1},showValidation:{type:Boolean},text:{},type:{}},emits:["inputChanged"],setup(C,{emit:v}){const t=C,a=c(),g=v,_=()=>{a.value=!a.value};return a.value=t.showFull||!1,(i,p)=>{var E;return n(),r("div",{onClick:ta(_,["self"]),class:"consent-item"},[o("div",{class:ee(["flex fdm-checkbox",[t.disabled?"fdm-checkbox--disabled":""]])},[o("input",{type:"checkbox",id:t.id,value:t.value,checked:t.value,disabled:t.disabled,onInput:p[0]||(p[0]=$=>g("inputChanged",{value:i.value,id:i.id}))},null,40,ia),o("label",{for:t.id,innerHTML:i.label,class:ee(["consent-item__label rich-text",{"consent-item__label--hidden":!a.value,"consent-item__label--error":t.showValidation}])},null,10,ua),i.text&&((E=i.text)==null?void 0:E.length)>0?(n(),r("span",da,[B(De,{infoText:t.text,slideVersion:""},null,8,["infoText"])])):k("",!0)],2),o("div",ca,[te(i.$slots,"default",{},void 0,!0)])])}}});const pa=ae(va,[["__scopeId","data-v-b61cf03f"]]),ha=["for"],_a=["id","name","disabled","value"],fa={key:0,disabled:"",value:""},ma=["value"],Me=se({__name:"UISelect",props:{id:{},name:{},value:{default:""},options:{},showValidation:{type:Boolean},disabledOption:{},label:{default:""},disabled:{type:Boolean,default:!1},validationTypes:{}},emits:["inputChanged","inputBlur","enter","validated"],setup(C,{expose:v,emit:t}){const a=C,g=s=>typeof s=="string"||typeof s=="number"?s:s.value,_=s=>typeof s=="string"||typeof s=="number"?s:s.value,i=c([]),p=t;Te(()=>{a.validationTypes&&a.value&&A()});const E=s=>{p("inputChanged",{value:s,name:a.name}),a.validationTypes&&(i.value=I(s))},$=s=>{p("inputBlur",a.name),a.validationTypes&&(i.value=I(s))},I=s=>{var L;if(!((L=a.validationTypes)!=null&&L.length))return p("validated",{name:a.name,errors:[]}),[];const w={types:a.validationTypes,input:s,errors:i.value},f=Ue(w),N=f.map(j=>j.id);return p("validated",{name:a.name,errors:N}),f},A=()=>{a.validationTypes&&(i.value=I(a.value))};return v({validate:A}),(s,w)=>(n(),r("div",null,[a.label?(n(),r("label",{key:0,for:a.id,class:"mb-2 inline-block"},b(a.label),9,ha)):k("",!0),o("select",{onChange:w[0]||(w[0]=f=>E(f.target.value)),onBlur:w[1]||(w[1]=f=>$(f.target.value)),id:a.id,name:a.name,disabled:a.disabled,value:a.value,class:ee(["fdm-select",[i.value.length&&a.showValidation?"border-fdm-red":""]])},[a.disabledOption?(n(),r("option",fa,b(_(a.disabledOption)),1)):k("",!0),a.options?(n(!0),r(S,{key:1},U(a.options,(f,N)=>(n(),r("option",{key:`${N}-${a.name}`,value:g(f)},b(_(f)),9,ma))),128)):k("",!0)],42,_a),B(Ge,{show:a.showValidation,errors:i.value},null,8,["show","errors"]),te(s.$slots,"default")]))}}),we=async C=>{try{const v=await Je.get(`/bas-auxiliaries-api/V1/auxiliaries/${C}`);return Promise.resolve(v.data)}catch(v){return Promise.reject(v)}},Ca=Ye("auxiliary",()=>{const{addLoadingState:C,removeLoadingState:v}=Ie();return{getCarMakes:async()=>{try{C(G.FETCH_CAR_MAKES);const _=we("clever-carmakelist");return Promise.resolve(_)}catch(g){return Promise.reject({type:"CarInfoAPIError",axios:g})}finally{v(G.FETCH_CAR_MAKES)}},getCarModelsByCarMake:async g=>{try{C(G.FETCH_CAR_MODELS);const _=we(g);return Promise.resolve(_)}catch(_){return Promise.reject({type:"CarInfoAPIError",axios:_})}finally{v(G.FETCH_CAR_MODELS)}}}}),ga={class:"content"},ba={class:"mt-16 mb-6"},ya={class:"content__box-carinfo-container"},xa={class:"content__box items-center"},ka={class:"text-base font-bold"},Ma={class:"col-span-2"},wa={class:"col-span-2"},Ia={class:"content__box-container"},Ta={class:"content__box-existing-member items-center"},Ea={class:"text-base font-bold"},$a=["innerHTML"],Va={class:"col-span-2"},Sa={class:"content__box-terms-container"},Ba={class:"content__section coverage-guidelines"},Na={class:"text-base font-bold mb-4"},Ra={key:0},Aa={key:0},La={key:0,class:"text-fdm-red text-xs font-normal"},Ha=["innerHTML"],Oa=se({__name:"TermsView",setup(C){var _e,fe;const v=ea(),t=je(),{handlerAPIErrors:a}=be(),g=Ca(),{dataExchangeConsentText:_,terms:i}=W(aa()),{appContent:p,progressionSteps:E,orderId:$,order:I,config:A,offlineSalesMode:s}=W(be()),{progressStepValue:w,existingMember:f,popoverContent:N,showPopover:L}=W(Ie()),{navigateToNextApp:j}=qe({basketId:$.value??"",isExistingMember:f.value,isOfflineMode:s.value,crmMessage:(fe=(_e=p.value)==null?void 0:_e.crmFlowMessages)==null?void 0:fe.flowCompleted}),ne=c(),le=c(),oe=c(),q=c(),z=c(),R=c({}),re=c(!1),K=c(!1),H=c(!1),ie=c(!1),ue=c(!1),O=c(""),P=c(""),M=c([]),y=J(()=>p?We("termsPage",p.value.pages):{});Te(async()=>{var e,h,x,m;try{i.value.forEach(u=>{R.value[`term-${u.code}`]=!1,(u.type===ye.DATA_EXCHANGE||s.value)&&M.value.push(u.code)}),await Le()}catch(u){a(u,v)}ze({funnelName:A.value.name,stepName:"clever_betingelser",userType:!!((h=(e=I.value)==null?void 0:e.customer)!=null&&h.fdmNumber),salesType:(x=I.value)==null?void 0:x.salesType,salesChannel:(m=I.value)==null?void 0:m.salesChannel})});const Ee=e=>{M.value.includes(e.termsCode)?M.value=M.value.filter(h=>h!==e.termsCode):M.value.push(e.termsCode),R.value[`term-${e.termsCode}`]=!0},Q=e=>M.value.length===0?!1:M.value.includes(e),$e=J(()=>de.value.length===0),de=J(()=>i.value.filter(e=>!M.value.includes(e.code))),Ve=async()=>{if(Oe())try{M.value.map(e=>t.addConsent(e)),await t.updateOrderBasket(),await t.validateCurrentOrder(),j(e=>{N.value=e,L.value=!0})}catch{v.push({name:xe.ERROR})}else de.value.forEach(e=>{R.value[`term-${e.code}`]=!0})},Se=()=>{v.push({name:xe.HOME,query:{basketId:$.value,existing:f.value?"1":"0"}})},Be=e=>{if(e.value){const h=e.value.replace(/-/g,""),x=new RegExp("^([a-zA-Z]{2})(?<=[a-zA-Z]{2})(\\d{0,3})(?<=\\d{0,3})(\\d{0,6})(?<=d{0,6})(\\w{0,1})$"),m=h.toUpperCase().match(x),u=m==null?void 0:m.slice(1);let T="";u?u==null||u.forEach((F,D)=>{T+=F+(u[D+1]?"-":"")}):T=h,t.setChargeChipNumber(T),t.setExistingCleverMembershipStatus(Ze(T))}else K.value=!1,t.setChargeChipNumber(""),t.setExistingCleverMembershipStatus(!1)},ce=()=>{K.value=!0},Ne=()=>(oe.value.validate(),re.value?!0:(ce(),!1)),Re=e=>{re.value=e.errors.length==0},ve=async e=>{var h;O.value=e.value,z.value=await g.getCarModelsByCarMake(`${((h=p.value)==null?void 0:h.labels.partnerName)??"clever"}-${e.value}`),t.setCarMake(e.value),X()},pe=e=>{P.value=e.value,t.setCarModel(e.value)},he=()=>{H.value=!0},Ae=()=>(H.value=!0,O.value.length>0&&P.value.length>0),Le=async()=>{var x,m;q.value=await g.getCarMakes();const e=t.getCarMakeInOrder??"",h=t.getCarModelInOrder??"";e.length>0&&(((x=q.value)==null?void 0:x.filter(u=>u.value===e).length)>0?(await ve({value:e}),ie.value=!0,h.length>0&&(((m=z.value)==null?void 0:m.filter(u=>u.value===h).length)>0?(await pe({value:h}),ue.value=!0):X())):(He(),X())),ne.value.validate(),le.value.validate()},He=()=>{t.setCarMake(""),O.value=""},X=()=>{t.setCarModel(""),P.value=""},Oe=()=>{let e=0;return $e.value||(e+=1),Ae()||(e+=1),Ne()||(e+=1),e===0};return(e,h)=>{var x,m,u,T,F,D,me,Ce;return n(),r(S,null,[o("main",ga,[B(l(Ke),{steps:l(E),"progress-status":l(w)},null,8,["steps","progress-status"]),o("h2",ba,b((x=y.value)==null?void 0:x.heading),1),o("div",ya,[o("div",xa,[o("h3",ka,b(y.value.carInfo.heading),1),o("div",Ma,[B(Me,{id:"select-carmake-field",onInputChanged:ve,name:"carMake",ref_key:"selectCarMakeRef",ref:ne,label:y.value.carInfo.make,options:q.value,"validation-types":["required"],"show-validation":H.value,value:O.value,onInputBlur:he,disabled:ie.value},null,8,["label","options","show-validation","value","disabled"])]),o("div",wa,[B(Me,{id:"select-carmodel-field",onInputChanged:pe,name:"carModel",ref_key:"selectCarModelRef",ref:le,label:y.value.carInfo.model,options:z.value,"validation-types":["required"],"show-validation":H.value,value:P.value,onInputBlur:he,disabled:ue.value},null,8,["label","options","show-validation","value","disabled"])])])]),o("div",Ia,[o("div",Ta,[o("h3",Ea,b(y.value.chargeChip.heading),1),o("div",{class:"col-span-2 raw rich-text",innerHTML:y.value.chargeChip.text},null,8,$a),o("div",Va,[(n(),Y(Qe,{class:"relative w-full",name:"charge-chip-field","max-length":"15","min-length":"15",ref_key:"chargeChipInputRef",ref:oe,value:l(t).chargeChipNumber,key:"charge-chip-input",uppercase:((m=l(t).chargeChipNumber)==null?void 0:m.length)>0,placeholder:"Indtast dit ladebrik nummer","validation-types":l(t).chargeChipNumber!==""?[l(Z).CHARGE_CHIP_NUMBER,l(Z).REQUIRED]:l(t).isChargeChipMandatory?[l(Z).REQUIRED]:[],onInputBlur:ce,"show-validation":K.value,onInputChanged:Be,onValidated:Re},null,8,["value","uppercase","validation-types","show-validation"]))])])]),o("div",Sa,[o("div",Ba,[o("h3",Na,b((u=y.value)==null?void 0:u.coverageConditionsHeading),1),(T=y.value)!=null&&T.coverageGuideLines.length?(n(),r("ol",Ra,[(n(!0),r(S,null,U(y.value.coverageGuideLines,(d,V)=>{var ge;return n(),r("li",{key:`coverage-maintext-${V}`},[sa(b(d.mainText)+" ",1),(ge=d.subText)!=null&&ge.length?(n(),r("ul",Aa,[(n(!0),r(S,null,U(d.subText,(Pe,Fe)=>(n(),r("li",{key:`coverage-subtext-${Fe}`},b(Pe),1))),128))])):k("",!0)])}),128))])):k("",!0),o("p",null,b((F=y.value)==null?void 0:F.coverageGuideLineNote),1),l(i).length&&!l(s)?(n(),Y(ra,{key:1,class:"mt-4"},{default:ke(()=>[(n(!0),r(S,null,U(l(i),d=>(n(),r(S,{key:`term-${d.code}`},[d.type!=l(ye).DATA_EXCHANGE?(n(),Y(pa,{key:0,id:`term-checkbox-${d.code}`,label:d.description,text:d.text,type:d.type,onInputChanged:V=>Ee({value:V.value,termsCode:d.code}),value:Q(d.code),"show-validation":!Q(d.code)&&R.value[`term-${d.code}`],"show-full":!1},{default:ke(()=>{var V;return[!Q(d.code)&&R.value[`term-${d.code}`]?(n(),r("p",La,b((V=l(p))==null?void 0:V.labels.required),1)):k("",!0)]}),_:2},1032,["id","label","text","type","onInputChanged","value","show-validation"])):k("",!0)],64))),128))]),_:1})):k("",!0),((D=l(_))==null?void 0:D.length)>0&&!l(s)?(n(),r("div",{key:2,class:"content__data-exchange-consent",innerHTML:l(_)},null,8,Ha)):k("",!0)])])]),B(Xe,{onNextClicked:Ve,onPreviousClicked:Se,labels:{next:(me=l(p))==null?void 0:me.labels.next,previous:(Ce=l(p))==null?void 0:Ce.labels.back},"show-next":!0,"show-previous":!0,"disable-previous":!l($)},null,8,["labels","disable-previous"])],64)}}});const Ga=ae(Oa,[["__scopeId","data-v-9793234b"]]);export{Ga as default};
