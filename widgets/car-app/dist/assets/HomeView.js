import{_ as pe,s as me,a as X,b as ae,u as ve,c as Y,R as K,d as F,L as O,e as he,r as _e}from"./index.js";import{d as H,e as h,f as i,V as M,W as G,K as g,G as u,M as $,J as D,L as y,P as j,r as z,O as fe,X as ie,Q as N,R as V,Y as q,Z as L,_ as S,$ as be,a0 as we,g as Q,a1 as U,a2 as Ee,a3 as ne,a4 as ke,b as ge,u as a}from"./embedder.js";import{u as B}from"./productConfig.js";const ye={class:"progression-bar"},Ce={class:"relative"},Re={class:"progression-bar__step-number"},Te={class:"progression-bar__step-text"},xe=H({__name:"UIProgressBar",props:{steps:{},progressStatus:{}},setup(e){const s=e,r=o=>s.progressStatus>=o+1?"progression-bar__step-divider--completed":"",t=o=>s.progressStatus>o+1?"progression-bar__step-counter--completed":s.progressStatus===o+1?"progression-bar__step-counter--active":"";return(o,v)=>(i(),h("div",ye,[(i(!0),h(M,null,G(s.steps,(c,l)=>(i(),h("div",{key:l,class:"progression-bar__step"},[l!==0?(i(),h("span",{key:0,class:$(["progression-bar__step-divider",r(l)])},null,2)):g("",!0),u("div",Ce,[u("span",{class:$(["progression-bar__step-counter",t(l)])},[D(pe,{class:"progression-bar__step-icon",icon:"check-mark"}),u("span",Re,y(l+1),1)],2),u("span",Te,y(c),1)])]))),128))]))}}),Ie=me(xe,[["__scopeId","data-v-3e7fcf37"]]),Pe={},Ae={class:"consent-box"};function Le(e,s){return i(),h("div",Ae,[j(e.$slots,"default",{},void 0,!0)])}const Ne=X(Pe,[["render",Le],["__scopeId","data-v-39e28d5a"]]),Se=["id","value","checked","disabled"],Oe=["for","innerHTML"],$e={class:"pl-[30px] mt-1"},Be=H({__name:"ConsentItem",props:{id:{},label:{},value:{type:Boolean},disabled:{type:Boolean,default:!1},showFull:{type:Boolean,default:!1},showValidation:{type:Boolean}},emits:["inputChanged"],setup(e,{emit:s}){const r=e,t=z(),o=s,v=()=>{t.value=!t.value};return t.value=r.showFull||!1,(c,l)=>(i(),h("div",{onClick:fe(v,["self"]),class:"consent-item"},[u("div",{class:$(["fdm-checkbox",[r.disabled?"fdm-checkbox--disabled":""]])},[u("input",{type:"checkbox",id:r.id,value:r.value,checked:r.value,disabled:r.disabled,onInput:l[0]||(l[0]=w=>o("inputChanged",{value:c.value,id:c.id}))},null,40,Se),u("label",{for:r.id,innerHTML:c.label,class:$(["consent-item__label rich-text",{"consent-item__label--hidden":!t.value,"consent-item__label--error":r.showValidation}])},null,10,Oe),u("div",$e,[j(c.$slots,"default",{},void 0,!0)])],2),r.showFull?g("",!0):(i(),h("span",{key:0,onClick:v,class:$(["consent-item__toggle",{"consent-item__toggle--open":t.value}])},[D(ae,{icon:"chevron",class:"w-5 h-5 stroke-3"})],2))]))}}),Me=X(Be,[["__scopeId","data-v-70f3d02d"]]),De={class:"w-full bg-white border-t sticky bottom-0 z-10"},Ve={key:0,class:"w-full border-b"},Fe={class:"w-full max-w-7xl mx-auto px-4 md:px-8 py-4 flex flex-wrap justify-end"},He={class:"w-full max-w-7xl mx-auto px-4 md:px-8 py-4 flex justify-between items-center space-x-4"},Ke=["href"],Ue=["disabled"],We=["href"],Ge=["disabled"],ze=H({__name:"CarWarrantyFooter",props:{labels:{},nextLink:{},previousLink:{},showNext:{type:Boolean},showPrevious:{type:Boolean},disableNext:{type:Boolean},disablePrevious:{type:Boolean},showFooterTopBar:{type:Boolean}},emits:["nextClicked","previousClicked"],setup(e,{emit:s}){const r=s;return(t,o)=>{const v=ie("router-link");return i(),h("footer",De,[t.showFooterTopBar?(i(),h("div",Ve,[u("div",Fe,[j(t.$slots,"default")])])):g("",!0),u("div",He,[t.previousLink&&!t.previousLink.startsWith("http")?(i(),N(v,{key:0,to:t.previousLink,class:"fdm-button fdm-button--blue fdm-button--outline w-32 sm:w-48 text-center text-sm sm:text-base"},{default:V(()=>[q(y(t.labels.previous),1)]),_:1},8,["to"])):g("",!0),t.previousLink&&t.previousLink.startsWith("http")?(i(),h("a",{key:1,href:t.previousLink,class:"fdm-button fdm-button--blue fdm-button--outline w-32 sm:w-48 text-center text-sm sm:text-base"},y(t.labels.previous),9,Ke)):g("",!0),t.showPrevious?(i(),h("button",{key:2,onClick:o[0]||(o[0]=c=>r("previousClicked")),disabled:t.disablePrevious,class:"fdm-button fdm-button--blue fdm-button--outline w-32 sm:w-48 text-center text-sm sm:text-base"},y(t.labels.previous),9,Ue)):g("",!0),o[2]||(o[2]=u("div",{class:"flex-1"},null,-1)),t.nextLink&&!t.nextLink.startsWith("http")?(i(),N(v,{key:3,to:t.nextLink,disabled:t.disableNext,class:"fdm-button fdm-button--blue w-32 sm:w-48 text-center text-sm sm:text-base"},{default:V(()=>[q(y(t.labels.next),1)]),_:1},8,["to","disabled"])):g("",!0),t.nextLink&&t.nextLink.startsWith("http")?(i(),h("a",{key:4,href:t.nextLink,class:"fdm-button fdm-button--blue w-32 sm:w-48 text-center text-sm sm:text-base"},y(t.labels.next),9,We)):g("",!0),t.showNext?(i(),h("button",{key:5,onClick:o[1]||(o[1]=c=>r("nextClicked")),disabled:t.disableNext,class:"fdm-button fdm-button--blue w-32 sm:w-48 text-center text-sm sm:text-base"},y(t.labels.next),9,Ge)):g("",!0)])])}}}),qe=({funnelName:e,stepName:s,userType:r,salesType:t,salesChannel:o})=>{window.dataLayer=window.dataLayer||[],window.dataLayer.push({auth:null}),window.dataLayer.push({event:"orderflow",funnel:e,step_name:s,userType:r?"member":"unknown",sales_type:t,sales_channel:o})};var le=(e=>(e.INDEX="index",e.ORDER_BASKETS_API_ERROR="getOrderbasketsAPIError",e.UPDATE_ORDER_BASKETS_API_ERROR="updateOrderbasketsAPIError",e.GET_TERMS_API_ERROR="getTermsAPIError",e))(le||{}),de=(e=>(e.GENERIC_API_ERROR="genericAPIError",e))(de||{});const W=(e,s)=>(e==null?void 0:e[s])??(e==null?void 0:e[L.GENERIC])??"An error occurred",ue=()=>{const e=ve(),s=Y(),r=B(),{getCwAppDrupalPage:t,getCwSharedDrupalPage:o}=s,v=n=>n===S.INTERNAL_SERVER||n===501||n>=S.SERVICE_UNAVAILABLE&&n<=599,c=n=>{const _={[S.BAD_REQUEST]:L.BAD_REQUEST,[S.NOT_FOUND]:L.NOT_FOUND,[S.BAD_GATEWAY]:L.BAD_GATEWAY};return v(n)?L.INTERNAL_SERVER:_[n]||L.GENERIC};return{handleApiError:(n,_)=>{const E=o(de.GENERIC_API_ERROR),C=_?t(_):null;if(!(n!=null&&n.status))return r.errorMessage=W(E,L.NO_RESPONSE),e.push({name:K.ERROR});r.errorCode=`http-${n.status}`;const R=c(n.status);r.errorMessage=W(C||E,R),e.push({name:K.ERROR})},handleFrontendError:(n="Siden svarer ikke.")=>{r.errorMessage=n,e.push({name:K.ERROR})}}},Qe=()=>{const e=B(),{termsList:s,order:r,orderId:t,config:o}=F(e),{handleApiError:v}=ue();return{initializeData:async()=>{const{useFetchTerms:l,useFetchProductPackage:w,useFetchOrderBasket:n}=e;s.value=[];const{_get:_,error:E}=w({url:"productPackage",loadingKey:O.APP,transformer:m=>{o.value=m}}),{_get:C,error:R}=l({url:"definitions",loadingKey:O.APP,transformer:m=>{s.value=s.value?s.value.concat(m):[m]}}),{_get:x,error:f}=n({url:`orderbaskets-api/baskets/${t.value}`,loadingKey:O.APP,transformer:m=>{r.value=m.order}}),k=[...new Set(["8","9"])].filter(m=>!s.value.some(A=>A.code===m)).map(m=>C({url:`${m}`}));await Promise.allSettled([_({url:be}),...k,x()]);const T=[{error:E.value},{error:R.value,type:"getTermsAPIError"},{error:f.value,type:"getOrderbasketsAPIError"}].find(({error:m})=>m.error);return T?v(T.error.error,T.type):!0}}},Xe=["WillisOrderLine","QBEOrderLine"],Ye=e=>{var s;return(e==null?void 0:e.salesType)===we.CRM&&((s=e==null?void 0:e.customer)!=null&&s.fdmNumber)?{"X-MemberId":e.customer.fdmNumber}:{}},je=()=>{const e=B(),{order:s,orderId:r}=F(e),{handleApiError:t}=ue();return{updateOrderTerms:async v=>{const{usePatchOrderBasket:c}=e;if(!s.value||!v.length)throw new Error("order-is-undefined");const{_patch:l,error:w}=c({url:"orderbaskets-api/baskets",loadingKey:O.APP,transformer:f=>{s.value=f.order,he(f.order.orderId),r.value=f.order.orderId}}),{_post:n,error:_}=e.useValidateOrderBasket({url:`orderbaskets-api/baskets/${r.value}/validate`,loadingKey:O.APP,headers:Ye(s.value)}),E=s.value.orderlines.find(f=>Xe.includes(f.type));if(!E)throw new Error("orderline-not-found");const C=v.map(f=>({termsCode:f.code,acceptDate:e!=null&&e.isOfflineSalesMode?void 0:new Date}));E.termsAndConditions=C,await l({key:"",body:{order:s.value}}),await n({body:void 0});const x=[{error:_.value},{error:w.value,type:"updateOrderbasketsAPIError"}].find(({error:f})=>f.error);if(x){t(x.error.error,x.type);return}return s.value}}},Je=e=>{const s=Y(),r=B(),{termsList:t,isOfflineSalesMode:o,order:v,orderId:c}=F(r),l=z([]),w=z({}),n=()=>{l.value=t.value.map(d=>({selected:!1,code:d.code})),t.value.forEach(d=>{w.value[`term-${d.code}`]=!1})},_=d=>{const p=l.value.find(k=>k.code===d.id);p&&(p.selected=!p.selected),w.value[`term-${p==null?void 0:p.code}`]=!0},E=Q(()=>!l.value.some(d=>!d.selected)),C=Q(()=>l.value.filter(d=>!d.selected)),R=()=>{C.value.forEach(d=>{w.value[`term-${d.code}`]=!0})};return{tempTerms:l,showValidation:w,isTermsValid:E,invalidTerms:C,initializeTerms:n,handleInputChange:_,handleNext:async()=>{if(!o.value&&(!E.value||!v.value)){R();return}const d=o.value?t.value.map(P=>({selected:!0,code:P.code})):l.value,p=await e(d);if(!p)return;if(o.value){s.popoverContent=ke.CRM_FLOW_COMPLETED_WARNING,s.showPopover=!0;return}const k=new URL("https://webcheckoutappisodev.z16.web.core.windows.net/");k.searchParams.set(U.BASKET_ID,p.orderId),window.location.assign(k.toString())},handlePrevious:()=>{if(!c.value)return;let d;if(o.value)d=new URL("https://webcarwrntywdgtqbeisodev.z16.web.core.windows.net/");else{const k=_e.currentRoute.value.query[U.EXISTING]===Ee.YES?ne.MEMBERSHIP:ne.CREATE_MEMBERSHIP;d=new URL(k,"https://webmembershipappisodev.z16.web.core.windows.net/")}d.searchParams.set(U.BASKET_ID,c.value),window.location.assign(d.toString())}}},Ze={class:"content"},et={class:"mt-16 mb-6"},tt={class:"content__conditions-heading"},st={class:"content__conditions"},rt={class:"content__condition-icon-container"},ot=["innerHTML"],nt=["innerHTML"],at={key:0,class:"text-fdm-red text-xs font-normal"},it=H({__name:"HomeView",setup(e){const s=Y(),{configName:r,termsList:t,order:o,orderId:v,isOfflineSalesMode:c}=F(B()),{updateOrderTerms:l}=je(),w=Q(()=>{var p;return(p=s==null?void 0:s.sharedDrupalContent)==null?void 0:p.progressionSteps.map(k=>k.text)}),n=s==null?void 0:s.getCwAppDrupalPage(le.INDEX),{tempTerms:_,showValidation:E,initializeTerms:C,handleInputChange:R,handleNext:x,handlePrevious:f}=Je(l),d=R;return ge(async()=>{var P,T,m,A;const{initializeData:p}=Qe();await p()&&(C(),qe({funnelName:r.value,stepName:"accept",userType:!!((T=(P=o.value)==null?void 0:P.customer)!=null&&T.fdmNumber),salesType:(m=o.value)==null?void 0:m.salesType,salesChannel:(A=o.value)==null?void 0:A.salesChannel}))}),(p,k)=>{var T,m,A,J,Z,ee;const P=ie("router-view");return i(),h(M,null,[u("main",Ze,[(i(),N(P,{key:p.$route.fullPath})),w.value?(i(),N(a(Ie),{key:0,steps:w.value,"progress-status":2},null,8,["steps"])):g("",!0),u("h2",et,y((T=a(n))==null?void 0:T.heading),1),u("h3",tt,y((m=a(n))==null?void 0:m.coverageConditionsHeading),1),u("div",st,[(i(),h(M,null,G(4,b=>u("div",{key:`condition-${b}`,class:"content__condition"},[q(y(a(n).coverageConditionText)+" ",1),u("div",rt,[D(ae,{icon:a(n)[`coverageConditionIcon${b}`],class:"w-6 h-6 md:w-9 md:h-9"},null,8,["icon"])]),u("div",{class:"content__condition-text",innerHTML:a(n)[`coverageConditionText${b}`]},null,8,ot)])),64))]),u("div",{class:"content__section",innerHTML:a(n).uncoveredConditions},null,8,nt),!a(c)&&a(_).length&&a(t).length?(i(),N(Ne,{key:1,class:"mt-6"},{default:V(()=>[(i(!0),h(M,null,G(a(t),b=>{var te,se;return i(),N(Me,{key:`term-${b.code}`,id:`term-checkbox-${b.code}`,label:b.text,value:((te=a(_).find(I=>I.code===b.code))==null?void 0:te.selected)??!1,"show-validation":!((se=a(_).find(I=>I.code===b.code))!=null&&se.selected)&&a(E)[`term-${b.code}`],"show-full":b.code===9,onInputChanged:I=>a(d)({value:I.value,id:b.code})},{default:V(()=>{var I,re,oe;return[!((I=a(_).find(ce=>ce.code===b.code))!=null&&I.selected)&&a(E)[`term-${b.code}`]?(i(),h("p",at,y((oe=(re=a(s))==null?void 0:re.drupalContent)==null?void 0:oe.labels.required),1)):g("",!0)]}),_:2},1032,["id","label","value","show-validation","show-full","onInputChanged"])}),128))]),_:1})):g("",!0)]),D(ze,{labels:{next:(J=(A=a(s))==null?void 0:A.drupalContent)==null?void 0:J.labels.next,previous:(ee=(Z=a(s))==null?void 0:Z.drupalContent)==null?void 0:ee.labels.back},"show-next":!0,"show-previous":!0,"disable-previous":!a(v),onNextClicked:a(x),onPreviousClicked:a(f)},null,8,["labels","disable-previous","onNextClicked","onPreviousClicked"])],64)}}}),ct=X(it,[["__scopeId","data-v-d22c008d"]]);export{ct as default};
