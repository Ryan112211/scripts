import{_ as pe,s as me,a as ne,b as ae,u as fe,c as q,R as W,d as V,L as O,e as ve,r as he}from"./index.js";import{d as H,e as v,f as l,T as M,V as U,J as g,F as u,L as $,I as D,K as k,O as X,r as z,N as be,W as le,Q as N,R as F,X as G,g as Q,b as _e,z as a}from"./embedder.js";import{E as L,u as B,H as S,P as we,S as Ee,Q as re,a as ge,N as oe,W as ke}from"./productConfig.js";const ye={class:"progression-bar"},xe={class:"relative"},Ce={class:"progression-bar__step-number"},Re={class:"progression-bar__step-text"},Te=H({__name:"UIProgressBar",props:{steps:{},progressStatus:{}},setup(e){const s=e,r=o=>s.progressStatus>=o+1?"progression-bar__step-divider--completed":"",t=o=>s.progressStatus>o+1?"progression-bar__step-counter--completed":s.progressStatus===o+1?"progression-bar__step-counter--active":"";return(o,f)=>(l(),v("div",ye,[(l(!0),v(M,null,U(s.steps,(c,i)=>(l(),v("div",{key:i,class:"progression-bar__step"},[i!==0?(l(),v("span",{key:0,class:$(["progression-bar__step-divider",r(i)])},null,2)):g("",!0),u("div",xe,[u("span",{class:$(["progression-bar__step-counter",t(i)])},[D(pe,{class:"progression-bar__step-icon",icon:"check-mark"}),u("span",Ce,k(i+1),1)],2),u("span",Re,k(c),1)])]))),128))]))}}),Ie=me(Te,[["__scopeId","data-v-3e7fcf37"]]),Pe={},Ae={class:"consent-box"};function Le(e,s){return l(),v("div",Ae,[X(e.$slots,"default",{},void 0,!0)])}const Ne=ne(Pe,[["render",Le],["__scopeId","data-v-640f049a"]]),Se=["id","value","checked","disabled"],Oe=["for","innerHTML"],$e={class:"pl-[30px] mt-1"},Be=H({__name:"ConsentItem",props:{id:{},label:{},value:{type:Boolean},disabled:{type:Boolean,default:!1},showFull:{type:Boolean,default:!1},showValidation:{type:Boolean}},emits:["inputChanged"],setup(e,{emit:s}){const r=e,t=z(),o=s,f=()=>{t.value=!t.value};return t.value=r.showFull||!1,(c,i)=>(l(),v("div",{onClick:be(f,["self"]),class:"consent-item"},[u("div",{class:$(["fdm-checkbox",[r.disabled?"fdm-checkbox--disabled":""]])},[u("input",{type:"checkbox",id:r.id,value:r.value,checked:r.value,disabled:r.disabled,onInput:i[0]||(i[0]=w=>o("inputChanged",{value:c.value,id:c.id}))},null,40,Se),u("label",{for:r.id,innerHTML:c.label,class:$(["consent-item__label rich-text",{"consent-item__label--hidden":!t.value,"consent-item__label--error":r.showValidation}])},null,10,Oe),u("div",$e,[X(c.$slots,"default",{},void 0,!0)])],2),r.showFull?g("",!0):(l(),v("span",{key:0,onClick:f,class:$(["consent-item__toggle",{"consent-item__toggle--open":t.value}])},[D(ae,{icon:"chevron",class:"w-5 h-5 stroke-3"})],2))]))}}),Me=ne(Be,[["__scopeId","data-v-7d0aafcb"]]),De={class:"w-full bg-white border-t sticky bottom-0 z-10"},Fe={key:0,class:"w-full border-b"},Ve={class:"w-full max-w-7xl mx-auto px-4 md:px-8 py-4 flex flex-wrap justify-end"},He={class:"w-full max-w-7xl mx-auto px-4 md:px-8 py-4 flex justify-between items-center space-x-4"},We=["href"],Ke=["disabled"],Ue=["href"],ze=["disabled"],Ge=H({__name:"CarWarrantyFooter",props:{labels:{},nextLink:{},previousLink:{},showNext:{type:Boolean},showPrevious:{type:Boolean},disableNext:{type:Boolean},disablePrevious:{type:Boolean},showFooterTopBar:{type:Boolean}},emits:["nextClicked","previousClicked"],setup(e,{emit:s}){const r=s;return(t,o)=>{const f=le("router-link");return l(),v("footer",De,[t.showFooterTopBar?(l(),v("div",Fe,[u("div",Ve,[X(t.$slots,"default")])])):g("",!0),u("div",He,[t.previousLink&&!t.previousLink.startsWith("http")?(l(),N(f,{key:0,to:t.previousLink,class:"fdm-button fdm-button--blue fdm-button--outline w-32 sm:w-48 text-center text-sm sm:text-base"},{default:F(()=>[G(k(t.labels.previous),1)]),_:1},8,["to"])):g("",!0),t.previousLink&&t.previousLink.startsWith("http")?(l(),v("a",{key:1,href:t.previousLink,class:"fdm-button fdm-button--blue fdm-button--outline w-32 sm:w-48 text-center text-sm sm:text-base"},k(t.labels.previous),9,We)):g("",!0),t.showPrevious?(l(),v("button",{key:2,onClick:o[0]||(o[0]=c=>r("previousClicked")),disabled:t.disablePrevious,class:"fdm-button fdm-button--blue fdm-button--outline w-32 sm:w-48 text-center text-sm sm:text-base"},k(t.labels.previous),9,Ke)):g("",!0),o[2]||(o[2]=u("div",{class:"flex-1"},null,-1)),t.nextLink&&!t.nextLink.startsWith("http")?(l(),N(f,{key:3,to:t.nextLink,disabled:t.disableNext,class:"fdm-button fdm-button--blue w-32 sm:w-48 text-center text-sm sm:text-base"},{default:F(()=>[G(k(t.labels.next),1)]),_:1},8,["to","disabled"])):g("",!0),t.nextLink&&t.nextLink.startsWith("http")?(l(),v("a",{key:4,href:t.nextLink,class:"fdm-button fdm-button--blue w-32 sm:w-48 text-center text-sm sm:text-base"},k(t.labels.next),9,Ue)):g("",!0),t.showNext?(l(),v("button",{key:5,onClick:o[1]||(o[1]=c=>r("nextClicked")),disabled:t.disableNext,class:"fdm-button fdm-button--blue w-32 sm:w-48 text-center text-sm sm:text-base"},k(t.labels.next),9,ze)):g("",!0)])])}}}),Qe=({funnelName:e,stepName:s,userType:r,salesType:t,salesChannel:o})=>{window.dataLayer=window.dataLayer||[],window.dataLayer.push({auth:null}),window.dataLayer.push({event:"orderflow",funnel:e,step_name:s,userType:r?"member":"unknown",salesType:t,salesChannel:o})};var ie=(e=>(e.INDEX="index",e.ORDER_BASKETS_API_ERROR="getOrderbasketsAPIError",e.UPDATE_ORDER_BASKETS_API_ERROR="updateOrderbasketsAPIError",e.GET_TERMS_API_ERROR="getTermsAPIError",e))(ie||{}),de=(e=>(e.GENERIC_API_ERROR="genericAPIError",e))(de||{});const K=(e,s)=>(e==null?void 0:e[s])??(e==null?void 0:e[L.GENERIC])??"An error occurred",ue=()=>{const e=fe(),s=q(),r=B(),{getCwAppDrupalPage:t,getCwSharedDrupalPage:o}=s,f=n=>n===S.INTERNAL_SERVER||n===501||n>=S.SERVICE_UNAVAILABLE&&n<=599,c=n=>{const h={[S.BAD_REQUEST]:L.BAD_REQUEST,[S.NOT_FOUND]:L.NOT_FOUND,[S.BAD_GATEWAY]:L.BAD_GATEWAY};return f(n)?L.INTERNAL_SERVER:h[n]||L.GENERIC};return{handleApiError:(n,h)=>{const E=o(de.GENERIC_API_ERROR),y=h?t(h):null;if(!(n!=null&&n.status))return r.errorMessage=K(E,L.NO_RESPONSE),e.push({name:W.ERROR});r.errorCode=`http-${n.status}`;const C=c(n.status);r.errorMessage=K(y||E,C),e.push({name:W.ERROR})},handleFrontendError:(n="Siden svarer ikke.")=>{r.errorMessage=n,e.push({name:W.ERROR})}}},qe=()=>{const e=B(),{termsList:s,order:r,orderId:t,config:o}=V(e),{handleApiError:f}=ue();return{initializeData:async()=>{const{useFetchTerms:i,useFetchProductPackage:w,useFetchOrderBasket:n}=e;s.value=[];const{_get:h,error:E}=w({url:"productPackage",loadingKey:O.APP,transformer:m=>{o.value=m}}),{_get:y,error:C}=i({url:"definitions",loadingKey:O.APP,transformer:m=>{s.value=s.value?s.value.concat(m):[m]}}),{_get:T,error:b}=n({url:`orderbaskets-api/baskets/${t.value}`,loadingKey:O.APP,transformer:m=>{r.value=m.order}}),x=[...new Set(["8","9"])].filter(m=>!s.value.some(A=>A.code===m)).map(m=>y({url:`${m}`}));await Promise.allSettled([h({url:we}),...x,T()]);const R=[{error:E.value},{error:C.value,type:"getTermsAPIError"},{error:b.value,type:"getOrderbasketsAPIError"}].find(({error:m})=>m.error);return R?f(R.error.error,R.type):!0}}},Xe=["WillisOrderLine","QBEOrderLine"],Ye=e=>{var s;return(e==null?void 0:e.salesType)===Ee.CRM&&((s=e==null?void 0:e.customer)!=null&&s.fdmNumber)?{"X-MemberId":e.customer.fdmNumber}:{}},je=()=>{const e=B(),{order:s,orderId:r}=V(e),{handleApiError:t}=ue();return{updateOrderTerms:async f=>{const{usePatchOrderBasket:c}=e;if(!s.value||!f.length)throw new Error("order-is-undefined");const{_patch:i,error:w}=c({url:"orderbaskets-api/baskets",loadingKey:O.APP,transformer:b=>{s.value=b.order,ve(b.order.orderId),r.value=b.order.orderId}}),{_post:n,error:h}=e.useValidateOrderBasket({url:`orderbaskets-api/baskets/${r.value}/validate`,loadingKey:O.APP,headers:Ye(s.value)}),E=s.value.orderlines.find(b=>Xe.includes(b.type));if(!E)throw new Error("orderline-not-found");const y=f.map(b=>({termsCode:b.code,acceptDate:e!=null&&e.isOfflineSalesMode?void 0:new Date}));E.termsAndConditions=y,await i({key:"",body:{order:s.value}}),await n({body:void 0});const T=[{error:h.value},{error:w.value,type:"updateOrderbasketsAPIError"}].find(({error:b})=>b.error);if(T){t(T.error.error,T.type);return}return s.value}}},Je=e=>{const s=q(),r=B(),{termsList:t,isOfflineSalesMode:o,order:f,orderId:c}=V(r),i=z([]),w=z({}),n=()=>{i.value=t.value.map(d=>({selected:!1,code:d.code})),t.value.forEach(d=>{w.value[`term-${d.code}`]=!1})},h=d=>{const p=i.value.find(x=>x.code===d.id);p&&(p.selected=!p.selected),w.value[`term-${p==null?void 0:p.code}`]=!0},E=Q(()=>!i.value.some(d=>!d.selected)),y=Q(()=>i.value.filter(d=>!d.selected)),C=()=>{y.value.forEach(d=>{w.value[`term-${d.code}`]=!0})};return{tempTerms:i,showValidation:w,isTermsValid:E,invalidTerms:y,initializeTerms:n,handleInputChange:h,handleNext:async()=>{if(!o.value&&(!E.value||!f.value)){C();return}const d=o.value?t.value.map(P=>({selected:!0,code:P.code})):i.value,p=await e(d);if(!p)return;if(o.value){s.popoverContent=ke.CRM_FLOW_COMPLETED_WARNING,s.showPopover=!0;return}const x=`/embedded/checkout?basketId=${p.orderId}`;window.location.assign(x)},handlePrevious:()=>{if(!c.value)return;let d;if(o.value)d=new URL("https://webcarwrntywdgtqbeisodev.z16.web.core.windows.net/");else{const x=he.currentRoute.value.query[re.EXISTING]===ge.YES?oe.MEMBERSHIP:oe.CREATE_MEMBERSHIP;d=new URL(x,"https://webmembershipappisodev.z16.web.core.windows.net/")}d.searchParams.set(re.BASKET_ID,c.value),window.location.assign(d.toString())}}},Ze={class:"w-full max-w-3xl mx-auto px-4 pt-20 pb-6 flex flex-col items-center"},et={class:"mt-16 mb-6 text-center"},tt={class:"bg-white text-left px-8 py-6 mb-0.5 w-full md:mb-0 md:pb-0"},st={class:"grid md:grid-cols-2 w-full md:mb-0.5 md:bg-white"},rt={class:"mr-3 md:mx-3"},ot=["innerHTML"],nt=["innerHTML"],at={key:0,class:"text-fdm-red text-xs font-normal"},ut=H({__name:"HomeView",setup(e){const s=q(),{configName:r,termsList:t,order:o,orderId:f,isOfflineSalesMode:c}=V(B()),{updateOrderTerms:i}=je(),w=Q(()=>{var p;return(p=s==null?void 0:s.sharedDrupalContent)==null?void 0:p.progressionSteps.map(x=>x.text)}),n=s==null?void 0:s.getCwAppDrupalPage(ie.INDEX),{tempTerms:h,showValidation:E,initializeTerms:y,handleInputChange:C,handleNext:T,handlePrevious:b}=Je(i),d=C;return _e(async()=>{var P,R,m,A;const{initializeData:p}=qe();await p()&&(y(),Qe({funnelName:r.value,stepName:"accept",userType:!!((R=(P=o.value)==null?void 0:P.customer)!=null&&R.fdmNumber),salesType:(m=o.value)==null?void 0:m.salesType,salesChannel:(A=o.value)==null?void 0:A.salesChannel}))}),(p,x)=>{var R,m,A,Y,j,J;const P=le("router-view");return l(),v(M,null,[u("main",Ze,[(l(),N(P,{key:p.$route.fullPath})),w.value?(l(),N(a(Ie),{key:0,steps:w.value,"progress-status":2},null,8,["steps"])):g("",!0),u("h2",et,k((R=a(n))==null?void 0:R.heading),1),u("h3",tt,k((m=a(n))==null?void 0:m.coverageConditionsHeading),1),u("div",st,[(l(),v(M,null,U(4,_=>u("div",{key:`condition-${_}`,class:"flex flex-row justify-between items-center w-full bg-white px-8 py-6 mb-0.5 md:mb-0 md:px-6"},[G(k(a(n).coverageConditionText)+" ",1),u("div",rt,[D(ae,{icon:a(n)[`coverageConditionIcon${_}`],class:"w-6 h-6 md:w-9 md:h-9"},null,8,["icon"])]),u("div",{class:"w-full md:mx-3",innerHTML:a(n)[`coverageConditionText${_}`]},null,8,ot)])),64))]),u("div",{class:"bg-white px-8 py-6 mb-0.5 w-full",innerHTML:a(n).uncoveredConditions},null,8,nt),!a(c)&&a(h).length&&a(t).length?(l(),N(Ne,{key:1,class:"mt-6 w-full"},{default:F(()=>[(l(!0),v(M,null,U(a(t),_=>{var Z,ee;return l(),N(Me,{key:`term-${_.code}`,id:`term-checkbox-${_.code}`,label:_.text,value:((Z=a(h).find(I=>I.code===_.code))==null?void 0:Z.selected)??!1,"show-validation":!((ee=a(h).find(I=>I.code===_.code))!=null&&ee.selected)&&a(E)[`term-${_.code}`],"show-full":_.code===9,onInputChanged:I=>a(d)({value:I.value,id:_.code})},{default:F(()=>{var I,te,se;return[!((I=a(h).find(ce=>ce.code===_.code))!=null&&I.selected)&&a(E)[`term-${_.code}`]?(l(),v("p",at,k((se=(te=a(s))==null?void 0:te.drupalContent)==null?void 0:se.labels.required),1)):g("",!0)]}),_:2},1032,["id","label","value","show-validation","show-full","onInputChanged"])}),128))]),_:1})):g("",!0)]),D(Ge,{labels:{next:(Y=(A=a(s))==null?void 0:A.drupalContent)==null?void 0:Y.labels.next,previous:(J=(j=a(s))==null?void 0:j.drupalContent)==null?void 0:J.labels.back},"show-next":!0,"show-previous":!0,"disable-previous":!a(f),onNextClicked:a(T),onPreviousClicked:a(b)},null,8,["labels","disable-previous","onNextClicked","onPreviousClicked"])],64)}}});export{ut as default};
